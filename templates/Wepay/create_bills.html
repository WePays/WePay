{% extends 'Wepay/base.html' %}
{% load tailwind_tags %}
{% tailwind_css %}

{% block extra_head %}
    <link
        href="https://cdn.jsdelivr.net/npm/tom-select/dist/css/tom-select.css"
        rel="stylesheet"
    />

{% endblock extra_head %}

{% block title %}
    Create Bills
{% endblock title %}
{{ block.super }}


{% block body %}
    <body>
        {% if user.is_authenticated %}
            <div class="grid h-screen place-items-center">
                <form action="" method="POST", id='form' onsubmit="create_title.disabled = true; return true;">
                    {% csrf_token %}
                    <div class="first-body">

                        <div class="font-bold text-4xl text-[#171f99] mt-12 ml-32">Create Bill: </div>

                        <div class="mt-10 ml-36 text-xl"> Bill's title:
                            <br>
                            <input class="mt-5 w-96 rounded hover:bg-gray-100" type="text" name="title" id="title" maxlength="100" placeholder="Enter the title of the bill" required>
                        </div>
                    </div>

                    <div class="mt-10 ml-36 font-bold text-xl">Initial Topic</div>

                    <div class="mt-5 ml-36">Topic Name:
                        <br>
                        <input class="mt-5 w-96 mt-3 rounded hover:bg-gray-100" type="text" name="topic_name" id="topic_name" maxlength="100" placeholder="Enter the topic name" required>
                    </div>

                    <div class="mt-10 ml-36"> Price:
                        <br>
                        <input class="mt-3 rounded hover:bg-gray-100" type="number" min="0" name="topic_price" id="topic_price" max="9999999999" placeholder="Enter the topic price" required>
                    </div>

                    <div class="mt-10 ml-36 w-1/2">
                        <label class="inline-block text-sm text-gray-600" for="Multiselect"
                        >Enter user to assign:</label
                            >
                            <div class="relative flex w-full">
                                <select
                                    id="username"
                                    name="username[]"
                                    multiple
                                    autocomplete="on"
                                    class="block w-full rounded-sm cursor-pointer focus:outline-none"
                                    multiple
                                    required
                                >
                                    {% for name in lst_user %}
                                        <option value="{{name}}" style="color: seagreen;">{{name}}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <script src="https://cdn.jsdelivr.net/npm/tom-select/dist/js/tom-select.complete.min.js"></script>
                        <script>

                            var user_select =  new TomSelect('#username', {
                                plugins:['remove_button', 'clear_button'],

                                render:{
                                    item: function(data, escape) {
                                        return '<div>' + escape(data.text) + '</div>';
                                    },
                                }
                            });


                        </script>

                        {% if messages %}
                            <ul class="messages">
                                {% for message in messages %}
                                    <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                        <br>
                        <button class="absolute bottom-10 right-10 bg-[#171f99] hover:bg-green-500 text-white font-bold py-1 px-3 rounded  flex justify-center text-xl"><input type="submit" name="create_title" value="Create Title"></button>

                    </form>
                    <script>
                        clicked = false;

                        document.getElementById('form').addEventListener("submit", function(e){


                            e.preventDefault();

                            bill_title = document.getElementById('title').value;
                            topic_name = document.getElementById('topic_name').value
                            topic_price = document.getElementById('topic_price').value
                            username = user_select.getValue()


                            const formdata = new FormData(form);
                            formdata.append('title', bill_title);
                            formdata.append('topic_name', topic_name);
                            formdata.append('topic_price', topic_price);
                            formdata.append('username', username);
                            formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');
                            console.log(formData);

                            fetch("{% url 'bills:create' %}", {
                                method: 'POST',
                                body: formdata
                            })
                                .then(response => response.json())
                                .then(data => {
                                console.log('Success:', data);
                            })
                                .catch(error => {
                                console.error('Error:', error);
                            });
                        );
                        }

                    </script>
                </div>
            </div>
            </body>


        {% else %}
            <a href="/accounts/login/">Sign Up</a>
        {% endif %}

{% endblock body %}

